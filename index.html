<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
    />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#018786" />
    <style>
      @import url(http://fonts.googleapis.com/earlyaccess/notosanskr.css);
      .container {
        padding: 10px;
        padding-top: 65px;
      }

      body {
        margin: 0;
        background-color: #cfd8dc;
        font-family: "Noto Sans KR", sans-serif;
      }

      * {
        user-select: none;
      }

      .mdc-fab {
        position: fixed;
        right: 16px;
        bottom: 16px;
      }

      header.mdc-toolbar {
        background-color: #018786;
        z-index: 1000;
        position: fixed;
        box-shadow: 0px 0px 4px black;
      }

      .mdc-card {
        background-color: white;
        padding: 16px;
        margin-bottom: 8px;
      }

      section.category {
        font-size: 15px;
        color: #888888;
        font-weight: 700;
      }

      .mdc-card div.title {
        font-weight: 700;
        font-size: 20px;
        color: #333333;
      }

      .mdc-card div.subtitle {
        font-size: 16px;
        color: #aaaaaa;
        font-weight: 500;
      }

      .titler > * {
        display: inline-block;
      }

      .card-type-container {
        padding: 7px;
        background-color: #3f3f3f;
        border-radius: 47px;
        margin-right: 10px;
      }

      .card-type {
        font-size: 40px;
        color: white;
      }
    </style>
  </head>

  <body>
    <header class="mdc-toolbar">
      <div class="mdc-toolbar__row">
        <section class="mdc-toolbar__section mdc-toolbar__section--align-start">
          <button href="#" class="menu material-icons mdc-toolbar__menu-icon">
            menu
          </button>
          <span class="mdc-toolbar__title">피드</span>
        </section>
      </div>
    </header>
    <aside class="mdc-drawer mdc-drawer--temporary mdc-typography">
      <nav class="mdc-drawer__drawer">
        <header class="mdc-drawer__header">
          <div class="mdc-drawer__header-content">
            화천중학교 급식알리미
          </div>
        </header>
        <nav id="icon-with-text-demo" class="mdc-drawer__content mdc-list">
          <a class="mdc-list-item mdc-list-item--activated" href="#">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true"
              >inbox</i
            >Inbox
          </a>
          <a class="mdc-list-item" href="#">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true"
              >star</i
            >Star
          </a>
        </nav>
      </nav>
    </aside>
    <button class="mdc-fab material-icons" aria-label="Favorite">
      <span class="mdc-fab__icon">
        share
      </span>
    </button>

    <div class="container"></div>
    <div
      class="mdc-snackbar"
      aria-live="assertive"
      aria-atomic="true"
      aria-hidden="true"
    >
      <div class="mdc-snackbar__text"></div>
      <div class="mdc-snackbar__action-wrapper">
        <button type="button" class="mdc-snackbar__action-button"></button>
      </div>
    </div>
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script>
      let drawer = new mdc.drawer.MDCTemporaryDrawer(
        document.querySelector(".mdc-drawer--temporary")
      );
      document
        .querySelector(".menu")
        .addEventListener("click", () => (drawer.open = true));
      const MDCSnackbar = mdc.snackbar.MDCSnackbar;
      const MDCSnackbarFoundation = mdc.snackbar.MDCSnackbarFoundation;
      const snackbar = new MDCSnackbar(document.querySelector(".mdc-snackbar"));

      document.querySelectorAll(".meal .mdc-list-item").map((el) => {
        el.addEventListener(() => {
          snackbar.show({
            message: "관심 음식에 추가됨",
            actionText: "취소",
          });
        });
      });

      date = new Date();

      function getMeal(year, month, date, callback) {
        fetch(
          `https://hwacheon.ml/getLunch?year=${year}&month=${month}&date=${date}&school=%ED%99%94%EC%B2%9C%EA%B3%A0%EB%93%B1%ED%95%99%EA%B5%90&phase=4`
        )
          .then((e) => e.json())
          .then(callback);
      }

      function createCard(title, icon, subtitle, contents) {
        document.getElementsByClassName("container")[0].innerHTML += `
        <article class="mdc-card">
              <div class="titler">
                <section class="card-type-container">
                  <i class="material-icons card-type">${icon}</i>
                </section>
                <section>
                  <div class="title">${title}</div>
                  <div class="subtitle">${subtitle}</div>
                </section>
              </div>
              <div class="contents">${contents}</div>
        </article>
      `;
      }

      const Pue = (type, attrs) => {
        const el = document.createElement(type);
        if (attrs.children) {
          attrs.children.forEach((child) => el.appendChild(child));
        }
        Object.keys(attrs).forEach((key) => (el.key = attrs[key]));
      };

      Array(5)
        .fill()
        .map((_, index) => {
          getMeal(
            date.getFullYear(),
            date.getMonth() + 1,
            date.getDate() + index,
            (data) => {
              if (data.err) {
                createCard(
                  date.getMonth() +
                    1 +
                    "월 " +
                    (date.getDate() + i) +
                    "일 급식",
                  "restaurant",
                  "점심",
                  "급식 정보가 없습니다"
                );
              } else {
                createCard(
                  date.getMonth() +
                    1 +
                    "월 " +
                    (date.getDate() + i) +
                    "일 급식",
                  "restaurant",
                  "점심",
                  Pue("ul", {
                    className: "mdc-list mdc-list--two-line",
                    children: data.lunch.map((allergyInfo, menu) =>
                      Pue("li", {
                        className: "mdc-list-item",
                        children: Pue("span", {
                          className: "mdc-list-item__text",
                          innerHTML: menu,
                          children: Pue("span", {
                            className: "mdc-list-item__secondary-text",
                            innerHTML: allergyInfo,
                          }),
                        }),
                      })
                    ),
                  }).outerHTML
                );
              }
            }
          );
        });
    </script>
  </body>
</html>
